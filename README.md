# テレアポ文字起こし・品質チェックシステム（Dify互換版）

このシステムは、テレアポの音声ファイル（MP3形式）を自動で文字起こしし、**Difyと同じ詳細な品質チェック手法**を用いて品質評価を行い、Google Sheetsに結果を保存するシステムです。

## 🆕 Dify互換機能

### 詳細な品質チェック項目
- **社名・担当者名チェック**: SFIDA X社名と担当者名の適切な名乗り確認
- **テレアポ担当者対応チェック（9項目）**:
  - アプローチで販売店名、ソフト名の先出し
  - 同業他社の悪口等
  - 運転中や電車内でも無理やり続ける
  - 2回断られても食い下がる
  - 暴言・悪口・脅迫・逆上
  - 情報漏洩
  - 共犯（教唆・幇助）
  - 通話対応（無言電話／ガチャ切り）
  - 呼び方（決裁者 or 事務員）

- **ロングコールチェック**: 電話コール回数による長時間通話判定
- **お客様反応チェック（8項目）**:
  - 当社の電話お断り
  - しつこい・何度も電話がある
  - お客様専用電話番号と言われる
  - 口調を注意された
  - 怒らせた
  - 暴言を受けた
  - 通報する
  - 営業お断り

- **心構え・マナーチェック（9項目）**:
  - 事務員に対して代表者のことを「社長」「オーナー」「代表」と呼ぶ
  - 一人称が「僕」「自分」「俺」
  - 「弊社」のことを「うち」「僕ら」と言う
  - 謝罪が「すみません」「ごめんなさい」
  - 口調や態度が失礼
  - 会話が成り立っていない
  - 残債の「下取り」「買い取り」トーク
  - 嘘・真偽不明の発言
  - その他問題

### 担当者名リスト（Dify互換）
- 野田、永廣、猪俣、渡辺、工藤、前川、田本、立川、濱田

### ワークフロー（Dify互換）
1. **固有名詞置換**: 会社名・担当者名・迷惑電話防止・電話コール音の統一
2. **話者分離**: agent（テレアポ担当者）とcustomer（お客様）の発言分離
3. **段階的品質チェック**: 5つのカテゴリーで詳細チェック
4. **結果統合**: 全チェック結果をJSON形式で統合
5. **スプレッドシート出力**: 30列の詳細な結果をGoogle Sheetsに保存

## 主な機能

- **音声ファイル処理**: MP3形式の音声ファイルをアップロード（最大25MB）
- **AI文字起こし**: OpenAI Whisper APIを使用した日本語音声の高精度文字起こし
- **詳細品質チェック**: Difyと同じ26項目の詳細な品質評価
- **データ保存**: 品質チェック結果をGoogle Sheetsに自動保存（30列の詳細データ）
- **ユーザーインターフェース**: Streamlitを使用した直感的なWebインターフェース

## システム要件

- Python 3.11+
- OpenAI API キー
- Google Cloud Platform サービスアカウント
- Google Sheets API アクセス権限

## セットアップ

### 1. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. 環境変数の設定

`.env` ファイルを作成し、以下を設定：

```env
OPENAI_API_KEY=your_openai_api_key_here
```

### 3. Google Sheets認証設定

1. Google Cloud Platformでサービスアカウントを作成
2. 認証情報を `credentials.json` として保存
3. スプレッドシート「テレアポチェックシート」の「Difyテスト」シートにアクセス権限を付与

詳細な設定手順は `CREDENTIALS_SETUP.md` を参照してください。

### 4. Google Sheetsのヘッダー設定

「Difyテスト」シートの1行目に以下のヘッダーを設定：

| A列 | B列 | C列 | D列 | ... | AE列 |
|-----|-----|-----|-----|-----|------|
| テレアポ担当者名 | 社名・担当者判定 | アプローチで販売店名、ソフト名の先出し | 同業他社の悪口等 | ... | 処理状況 |

## 使用方法

### 1. アプリケーションの起動

```bash
streamlit run app.py
```

### 2. ブラウザでアクセス

通常は http://localhost:8501 でアクセス可能

### 3. 文字起こし

1. 「📝 文字起こし」タブを選択
2. MP3ファイルをアップロード
3. 「🎤 文字起こし開始」ボタンをクリック

### 4. 品質チェック

1. 「🔍 品質チェック」タブを選択
2. 担当者を選択（複数選択可能）
3. 処理設定を調整
4. 「🔍 品質チェック実行」ボタンをクリック

## 技術スタック

- **フロントエンド**: Streamlit（Pythonベースのウェブアプリフレームワーク）
- **音声処理API**: OpenAI Whisper API（AI音声認識モデル）
- **言語処理API**: OpenAI GPT-4o-mini（品質チェック用）
- **データストレージ**: Google Sheets API（スプレッドシート操作）
- **認証**: Google OAuth2.0（GCPサービスアカウント）
- **言語・環境**: Python 3.11+

## ファイル構成

```
teleapo_mvp/
├── app.py                      # メインアプリケーション
├── requirements.txt            # 依存パッケージリスト
├── .env                        # 環境変数設定ファイル
├── credentials.json            # Google API認証用JSONファイル
├── src/
│   ├── api/
│   │   ├── openai_client.py    # OpenAI API クライアント
│   │   └── sheets_client.py    # Google Sheets API クライアント
│   ├── ui/
│   │   ├── main_app.py         # メインアプリケーションロジック
│   │   ├── components.py       # UIコンポーネント
│   │   └── styles.py           # スタイル定義
│   ├── utils/
│   │   ├── quality_check.py    # 品質チェックワークフロー（Dify互換）
│   │   └── batch_processor.py  # バッチ処理管理
│   └── prompts/
│       └── system_prompts.py   # システムプロンプト（Dify互換）
├── README.md                   # このファイル
├── CREDENTIALS_SETUP.md        # 認証設定手順
└── LOCAL_SETUP.md             # ローカル環境セットアップ手順
```

## Difyとの互換性

このシステムは、Difyで開発された品質チェックワークフローと完全に互換性があります：

- **同じプロンプト**: Difyで使用されているプロンプトを完全再現
- **同じワークフロー**: 固有名詞置換 → 話者分離 → 品質チェック → JSON変換の流れ
- **同じ出力形式**: 30列の詳細なチェック結果をGoogle Sheetsに出力
- **同じ担当者リスト**: Difyで定義された9名の担当者名を使用

## トラブルシューティング

### よくある問題

1. **API接続エラー**: `.env` ファイルのAPIキーを確認
2. **Google Sheetsエラー**: `credentials.json` の設定とアクセス権限を確認
3. **アップロードエラー**: ファイルサイズ（25MB以下）と形式（MP3）を確認
4. **品質チェックエラー**: 担当者選択と処理対象データの存在を確認

### ログの確認

アプリケーション実行時のコンソール出力でエラー詳細を確認できます。

## ライセンス

© 2024 テレアポ品質チェックシステム - Version 1.2.0（Dify互換版）

## 更新履歴

### v1.2.0（Dify互換版）
- Difyと同じ詳細な品質チェック手法を実装
- 26項目の詳細チェック項目を追加
- 担当者リストをDify互換に更新
- Google Sheets出力を30列の詳細形式に変更
- ワークフローをDifyと完全互換に変更 