# テレアポ文字起こしシステム - 現状のシステム構成

## 1. システム概要

このシステムは、テレアポの音声ファイル（MP3形式）を自動で文字起こしし、Google Sheetsに結果を保存するMVP（Minimum Viable Product）です。電話営業の品質管理チームが効率的に通話内容を確認・分析できるように設計されています。

## 2. 主な機能

- **音声ファイル処理**：MP3形式の音声ファイルをアップロード（最大25MB）
- **AI文字起こし**：OpenAI Whisper APIを使用した日本語音声の高精度文字起こし
- **データ保存**：文字起こし結果をGoogle Sheetsに自動保存
- **ユーザーインターフェース**：Streamlitを使用した直感的なWebインターフェース

## 3. システム構成図

```
┌─────────────────┐    ┌───────────────┐    ┌─────────────────┐
│                 │    │               │    │                 │
│  Streamlit UI   ├───►│  OpenAI API   ├───►│  Google Sheets  │
│  (Web Browser)  │    │  (Whisper)    │    │  (データ保存)   │
│                 │    │               │    │                 │
└─────────────────┘    └───────────────┘    └─────────────────┘
```

## 4. ファイル構成

```
teleapo_mvp/
├── app.py              # メインアプリケーションコード
├── requirements.txt    # 依存パッケージリスト
├── .env                # 環境変数設定ファイル（APIキー等）
├── credentials.json    # Google API認証用JSONファイル
└── README.md           # プロジェクト説明書
```

## 5. 技術スタック

- **フロントエンド**：Streamlit（Pythonベースのウェブアプリフレームワーク）
- **音声処理API**：OpenAI Whisper API（AI音声認識モデル）
- **データストレージ**：Google Sheets API（スプレッドシート操作）
- **認証**：Google OAuth2.0（GCPサービスアカウント）
- **言語・環境**：Python 3.11+

## 6. 依存パッケージ

- streamlit==1.29.0：UI構築用
- openai==1.6.1：OpenAI API接続用
- gspread==5.12.4：Google Sheets操作用
- google-auth==2.25.2：Google認証用
- python-dotenv==1.0.0：環境変数管理用
- google-auth-oauthlib==1.2.0：OAuth認証用
- google-auth-httplib2==0.2.0：HTTP通信用

## 7. 認証設定

### OpenAI API認証
- `.env`ファイルにAPIキーを保存
- 環境変数`OPENAI_API_KEY`として読み込み

### Google Sheets API認証
- Google Cloud Platformでサービスアカウントを作成
- 認証情報を`credentials.json`として保存
- スプレッドシート「テレアポチェックシート」にアクセス権限を付与

## 8. 処理フロー

1. **ユーザーアクション**：
   - MP3ファイルをアップロード
   - 「文字起こし開始」ボタンをクリック

2. **バックエンド処理**：
   - 初期化（OpenAI、Google Sheets認証）
   - 音声ファイルを一時保存
   - OpenAI Whisper APIに送信
   - 文字起こし結果を受信
   - Google Sheetsに保存
     - A列：文字起こしテキスト
     - B列：ファイル名
     - C列：処理日時

3. **結果表示**：
   - 処理状況をリアルタイム更新
   - 成功時にUI上で結果表示
   - エラー発生時に適切なエラーメッセージ表示

## 9. エラーハンドリング

- ファイルサイズ・形式の検証
- API認証エラーの検出と表示
- スプレッドシート接続エラーの検出と表示
- 一時ファイルの確実な削除処理

## 10. 現状の制約と今後の課題

- 一度に1ファイルのみ処理可能
- 処理中のキャンセル機能がない
- 処理履歴の保存・閲覧機能なし
- 音声ファイル形式はMP3のみ対応
- 認証情報の安全な管理方法の改善

## 11. 使用方法

1. 必要な依存パッケージをインストール：
   ```
   pip install -r requirements.txt
   ```

2. 環境変数の設定：
   - `.env`ファイルにOpenAI APIキーを設定
   - Google認証用の`credentials.json`を配置

3. アプリケーションの起動：
   ```
   streamlit run app.py
   ```

4. ブラウザでStreamlitアプリにアクセス（通常は http://localhost:8501）

5. MP3ファイルをアップロードして文字起こし処理を実行

## 12. セキュリティ考慮事項

- APIキーは環境変数として管理（コードに直接記述しない）
- 認証情報は適切な権限設定で管理
- 一時ファイルは処理後に確実に削除
- エラーメッセージはセキュリティ情報を漏らさない設計 